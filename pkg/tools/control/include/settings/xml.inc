use uo;
use file;


function LoadOrCreateXMLSettings( package )

	var fileString := ":"+package+":config/settings.xml";

	var settingsFile := OpenXMLFile(fileString);
	if( !settingsFile )
		LogToFile("::log/control.xmlsettings.log","Settings.xml not found for package "+package, flags := LOG_DATETIME );
		settingsFile := CreateXMLFile();
		GenerateXMLBoilerPlate(settingsFile);
		SaveXMLFile(settingsFile, fileString);
		if(!settingsFile)
			LogToFile("::log/control.xmlsettings.log","Failure create XML settings file for package "+package+", maybe config/fileaccess.cfg needs to be modified?", flags := LOG_DATETIME );
			return settingsFile.errortext;
		endif
	endif

	return settingsFile;

endfunction

function GenerateXMLBoilerPlate( byref xmlFile )


	xmlFile.appendxmlcomment("File generated by ICP system.");
	//xmlFile.appendxmlnode("meta-data"/*, struct{"version" := 1.0, "package":="null"}*/);
	//currentNode := xmlFile["meta-data"];
	var metaNode := xmlFile.appendxmlnode("meta-data"/*, struct{"version" := 1.0, "package":="null"}*/);
	var versionNode := metaNode.appendxmlnode("version");
	versionNode.appendxmltext("1.0");
	var ReleaseNode := versionNode.appendxmlnode("Release");
	var TestNode := ReleaseNode.appendxmlnode("Test");
	var TestNode2 := TestNode.setxmlattribute(struct{"This is only a test":="pants"});
	TestNode2.setxmlattribute(struct{"test2":="pants"});

	metaNode.appendxmlnode("package");
	metaNode["package"].appendxmltext("null");
	xmlFile.appendxmlcomment("Package settings below this line");
	var settingsNode := xmlFile.appendxmlnode("settings");

endfunction

function SaveXMLFile( byref xmlFile, fileString )

	var saveAttempt := xmlFile.savexml(fileString);
	if(!saveAttempt)
		LogToFile("::log/control.xmlsettings.log","Failure save XML settings file at "+fileString+", maybe config/fileaccess.cfg needs to be modified?", flags := LOG_DATETIME );
		LogToFile("::log/control.xmlsettings.log","Error: "+saveAttempt.errortext, flags := LOG_DATETIME );
		return saveAttempt.errortext;
	endif

	return 1;

endfunction